{% extends "global/Page.html" %}
{% load staticfiles otree %}
{% load staticfiles %}
{% load otree static %}

{% block title %}
    The Choice List
{% endblock %}

{% block content %}
    <p style="text-align: center;font-size: 24px;">Today is <b><span id="date"></span></b> (MM-DD-YYYY, MM = month, DD = day of the month, YYYY = year).</p>


<script>
        var today = new Date();
        var year = today.getFullYear();
        var month = today.getMonth() + 1; // 月份从 0 开始，需要加 1
        var day = today.getDate();

        var formattedDate = month + '-' + day + '-' + year;

        document.getElementById("date").textContent = formattedDate;
</script>

<div class="otdm__choices-selection">
    <p>If you were given the choice between the following two options to receive money, which one would you prefer?</p>
    <p>Note: You are choosing between two payments in the future, the amount of money and date might be different from previous questions.</p>
    <table class="otdm__choices-table table table-bordered table-striped" style="table-layout: fixed;">
        <thead>
        <tr class="text-center">
            <th style="color: red;">Option A</th>
            <th style="color: red;" width="75">A</th>
            <th style="color: blue;" width="75">B</th>
            <th style="color: blue;">Option B</th>
        </tr>
        </thead>
        <tbody class="small">
        {% for day, rev_day in day_gain %}
        <tr>
            <td class="text-center">
                <span style="color: red;">$<span class="receiving_amount"></span> on <span class="receiving_date"></span></span>
            </td>
            <script>
    // JavaScript code to update the values
    var receivingAmount = 0; // 初始金额
    var currentDate = new Date();
    var futureDate = calculateFutureDate(13); // 计算7天之后的日期

    // 计算日期（假设您希望日期是15天之后的日期）
    function calculateFutureDate(daysInFuture) {
        var futureDate = new Date(currentDate);
        futureDate.setDate(currentDate.getDate() + daysInFuture); // 增加7天
        var year = futureDate.getFullYear();
        var month = futureDate.getMonth() + 1;
        var day = futureDate.getDate();
        return month + "-" + day + "-" + year;
    }

    // 获取所有包含 class="receiving_amount" 的元素
    var amountElements = document.querySelectorAll('.receiving_amount');

    // 更新每个元素的金额
    amountElements.forEach(function(element) {
        // 更新HTML中的金额
        element.textContent = receivingAmount;

        // 递增金额（每行增加1）
        receivingAmount += 1;
    });

    // 获取所有包含 class="receiving_date" 的元素
    var dateElements = document.querySelectorAll('.receiving_date');

    // 更新每个元素的日期
    dateElements.forEach(function(element) {
        // 更新HTML中的日期为15天之后的日期
        element.textContent = futureDate;
    });
</script>
            <td class="text-center otdm__choice-cell">
                <label>
                    <input type="radio" name="otdm__option_day{{forloop.counter}}"
                           class="otdm__choice-input"
                           value="A" data-day="{{ day }}" data-index="{{ forloop.counter }}">
                </label>
            </td>
            <td class="text-center otdm__choice-cell">
                <label>
                    <input type="radio" name="otdm__option_day{{forloop.counter}}"
                           class="otdm__choice-input"
                           value="B" data-day="{{ day }}" data-index="{{ forloop.counter }}">
                </label>
            </td>
            <td class="text-center">
                <span style="color: blue;">$24 on <span class="receiving_date1"></span></span>
        <script>

    var currentDate1 = new Date();
    var futureDate1 = calculateFutureDate(26); // 计算22天之后的日期

    // 计算日期（假设您希望日期是15天之后的日期）
    function calculateFutureDate(daysInFuture) {
        var futureDate1 = new Date(currentDate1);
        futureDate1.setDate(currentDate1.getDate() + daysInFuture); // 增加22天
        var year = futureDate1.getFullYear();
        var month = futureDate1.getMonth() + 1;
        var day = futureDate1.getDate();
        return month + "-" + day + "-" + year;
    }

    // 获取所有包含 class="receiving_date" 的元素
    var dateElements = document.querySelectorAll('.receiving_date1');

    // 更新每个元素的日期
    dateElements.forEach(function(element) {
        // 更新HTML中的日期为15天之后的日期
        element.textContent = futureDate1;
    });
</script>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <div class="otdm__waiting">
        You have to select an option above to continue.
    </div>
</div>

<div class="otdm__confirm-button-wrapper">
    <button class="btn btn-primary otdm__confirm-button" type="button">
        Confirm
    </button>
</div>

<div class="otdm__player-confirmation">
    <h5>Based on your indicated choice on the previous screen, <span style="color: red;">how certain</span> are you that you prefer to</h5>

    <p class="text-center">
        <span class="otdm__confirmation-either"></span>
    </p>

    <p class="text-center">
        <b>rather than</b>
    </p>

    <p class="text-center">
        <span class="otdm__confirmation-other"></span>
    </p>

<div class="certainty-question" style="margin-bottom: 20px;"> <!-- 增加了底部外边距 -->
    <div class="percentage-slider">
        {% formfield player.cert60 label="" %}
    </div>
    <div class="slider-labels" style="display: flex; justify-content: space-between; width: 100%; padding: 0 10px; font-weight: bold;"> <!-- 加粗文本 -->
        <span class="slider-label-left">very uncertain</span>
        <span class="slider-label-right">completely certain</span>
    </div>
</div>

    {% next_button %}

<input class="otdm__value" type="hidden" name="{{ var_name }}">

{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'otdm/styles/choices.css' %}"/>
{% endblock %}

{% block scripts %}
<script src="{% static 'otdm/scripts/choices.js' %}"></script>
{% endblock %}